<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <!-- CSS originais do qgis2web/Leaflet -->
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    <link rel="stylesheet" href="css/leaflet-control-geocoder.Geocoder.css">
    <link rel="stylesheet" href="css/leaflet-measure.css">

    <!-- Import da fonte Poppins para o título -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    >

    <!-- Estilos customizados -->
    <style>
      html, body, #map {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
      }

      /* Logo styling */
      .map-logo {
        position: absolute;
        bottom: 10px;
        left: 10px;
        width: 80px;
        opacity: 0.8;
        z-index: 1000;
        pointer-events: none;
      }

      /* Estilo do título no mapa */
      .map-title {
    display: inline-block;
    font-family: 'Poppins', sans-serif;
    font-size: 1.1rem;
    font-weight: 600;
    color: #fff;
    background: linear-gradient(135deg, rgba(0,123,255,0.9), rgba(0,200,255,0.9));
    padding: 6px 12px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
    animation: fadeInDown 0.6s ease-out;
    transition: transform 0.2s ease;
}
.map-title:hover {
    transform: translateY(-2px);
      }

      /* Ícone opcional à esquerda do texto */
      .map-title .title-icon {
        margin-right: 8px;
        width: 24px;
        height: 24px;
      }

      /* Animação de entrada */
      @keyframes fadeInDown {
        from { opacity: 0; transform: translateY(-20px); }
        to   { opacity: 1; transform: translateY(0); }
      }

      /* Popup mais suave */
      .leaflet-popup-content-wrapper {
        border-radius: 8px !important;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
      }
    </style>

    <title>Áreas de Propriedades Aderidas ao Programa PSA</title>
</head>
<body>
    <div id="map" style="position: relative;">
        <!-- Logo positioned at bottom-left -->
        <img class="map-logo" src="images/LOGOPSA.png" alt="Logo PSA">
    </div>

    <!-- Scripts qgis2web / Leaflet -->
    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/L.Control.Layers.Tree.min.js"></script>
    <script src="js/multi-style-layer.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="js/leaflet-control-geocoder.Geocoder.js"></script>
    <script src="js/leaflet-measure.js"></script>
    <script src="data/LotesRurais_2.js"></script>
    <script src="data/LimitedoPrograma_3.js"></script>
    <script src="data/reasaderidasaoPSA_4.js"></script>

    <script>
    // Inicialização do mapa
    var map = L.map('map', { zoomControl:false, maxZoom:28, minZoom:4 })
        .fitBounds([[-26.287853140824076,-49.13379903946285],
                    [-26.04023515439892,-48.87868148877471]]);
    var hash = new L.Hash(map);
    map.attributionControl.setPrefix(
      '<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; ' +
      '<a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; ' +
      '<a href="https://qgis.org">QGIS</a>'
    );
    var autolinker = new Autolinker({truncate:{length:30,location:'smart'}});

    // Funções utilitárias de popup
    function removeEmptyRowsFromPopupContent(content, feature) {
      var tempDiv = document.createElement('div');
      tempDiv.innerHTML = content;
      var rows = tempDiv.querySelectorAll('tr');
      for (var i = 0; i < rows.length; i++) {
        var td = rows[i].querySelector('td.visible-with-data');
        var key = td ? td.id : '';
        if (td && feature.properties[key] == null) {
          rows[i].parentNode.removeChild(rows[i]);
        }
      }
      return tempDiv.innerHTML;
    }
    function addClassToPopupIfMedia(content, popup) {
      var tempDiv = document.createElement('div');
      tempDiv.innerHTML = content;
      if (tempDiv.querySelector('td img')) {
        popup._contentNode.classList.add('media');
        setTimeout(function(){ popup.update(); }, 10);
      } else {
        popup._contentNode.classList.remove('media');
      }
    }

    // Controle customizado de título
    var title = new L.Control({position:'topright'});
    title.onAdd = function(map) {
      this._div = L.DomUtil.create('div', 'info');
      this.update();
      return this._div;
    };
    title.update = function () {
    this._div.innerHTML = '<h2>Áreas de Propriedades Aderidas ao Programa PSA</h2>';
};
title.addTo(map);

    // Controles de zoom e medida
    L.control.zoom({ position:'topleft' }).addTo(map);
    var measureControl = new L.Control.Measure({
      position:'topleft',
      primaryLengthUnit:'meters',
      secondaryLengthUnit:'kilometers',
      primaryAreaUnit:'sqmeters',
      secondaryAreaUnit:'hectares'
    }).addTo(map);
    document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
    document.getElementsByClassName('leaflet-control-measure-toggle')[0]
      .className += ' fas fa-ruler';

    var bounds_group = new L.featureGroup([]);
    function setBounds() {}
    // Panes e camadas base
    map.createPane('pane_GoogleSatellite_0');
    map.getPane('pane_GoogleSatellite_0').style.zIndex = 400;
    var layer_GoogleSatellite_0 = L.tileLayer(
      'https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',
      { pane: 'pane_GoogleSatellite_0', opacity: 1.0,
        attribution: '<a href="https://google.com">Map data ©2015 Google</a>',
        minZoom: 4, maxZoom: 28, minNativeZoom: 0, maxNativeZoom: 20 }
    ).addTo(map);

    map.createPane('pane_Positron_1');
    map.getPane('pane_Positron_1').style.zIndex = 401;
    var layer_Positron_1 = L.tileLayer(
      'https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png',
      { pane: 'pane_Positron_1', opacity: 1.0,
        attribution: '<a href="https://cartodb.com/basemaps/">CartoDB</a>',
        minZoom: 4, maxZoom: 28, minNativeZoom: 0, maxNativeZoom: 20 }
    ).addTo(map);

    // Camadas GeoJSON (exemplo resumido)
    // ... (seu código pop_LotesRurais_2, style_LotesRurais_2_0, etc.) ...

    // Geocoder e árvore de camadas
    var osmGeocoder = new L.Control.Geocoder({ collapsed:true, position:'topleft' }).addTo(map);
    document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
      .className += ' fa fa-search';

    var overlaysTree = [
      { label:'<img src="legend/reasaderidasaoPSA_4.png" /> Áreas aderidas ao PSA', layer: layer_reasaderidasaoPSA_4 },
      { label:'<img src="legend/LimitedoPrograma_3.png" /> Limite do Programa', layer: layer_LimitedoPrograma_3 },
      { label:'<img src="legend/LotesRurais_2.png" /> Lotes Rurais', layer: layer_LotesRurais_2 },
      { label:'Positron', layer: layer_Positron_1, radioGroup:'bm' },
      { label:'Google Satellite', layer: layer_GoogleSatellite_0, radioGroup:'bm' }
    ];
    L.control.layers.tree(null, overlaysTree, { collapsed:true }).addTo(map);

    setBounds();
    resetLabels([layer_reasaderidasaoPSA_4]);
    map.on("zoomend layeradd layerremove", function() {
      resetLabels([layer_reasaderidasaoPSA_4]);
    });
    </script>
</body>
</html>